import {
  CodeSurfer,
  CodeSurferColumns,
  Step,
} from "code-surfer";
import { vsDark } from "@code-surfer/themes";
import ofbizArchitecture from './images/ofbiz-architecture.png';

export const theme = vsDark;

# Hello ðŸ‘‹

This is an introduction to the [OFBiz Framework](https://cwiki.apache.org/confluence/display/OFBIZ/OFBiz+Tutorial+-+A+Beginners+Development+Guide)

<small>Use the arrow keys to change slides</small>

---

## What is covered in this presentation

- [Controllers](/3)
- [Screens](/8)
- [Services](/10)
- [Query classes](/12)

---

## How ofbiz works

<img src={ofbizArchitecture} style="height:70vh;"/>

---

## The controller

The controller is the entry point to the application.<br/>
It defines any links accessible by the browser.<br/>
These can be found in `controller.xml` files.

---

<CodeSurfer>

```xml file=./snippets/controller.xml title="The controller"

```

```diff 8:12 title="Requests" subtitle="Requests are the actual 'links' that the browser will access."

```

```diff 8[23:34] title="Request URIs" subtitle="By specifiying this property, the server will listen to requests to the '/hr/control/EditEmployee' URL."

```

```diff 9 title="Security" subtitle="This tag defines if authentication is required for this request. This line should be there most of the time."

```

```diff 10[19:32],11[19:30],15[19:32],16[19:30],17[19:34] title="Response names" subtitle="Based on the state of the code executed during this request, the server can do different things (e.g. redirect to an error page if there was an error)."

```

</CodeSurfer>

---

## Controller Responses

We are going to explore the two most common response types

---

<CodeSurferColumns>

<Step>

```xml 1[30:40] title="Views" subtitle="Views are responses that usually return HTML. (they can also return PDFs, CSVs and other "user-friendly" outputs."
    <response name="success" type="view" value="EditEmployee"/>
```

```xml 1[30:43],2[28:41] title="Requests" subtitle="Requests are responses that return either raw data (json), or call a different request (directly, or by redirecting the user to one)."
    <response name="success" type="request" value="json"/>
    <response name="error" type="request" value="json"/>
```

</Step>

<Step>

```xml 3,7,8 subtitle="Views have a corresponding 'view-map' at the end of the same controller.xml file that defines the type of view, and what will produce the output."
<request-map uri="EditEmployee">
    <security https="true" auth="true"/>
    <response name="success" type="view" value="EditEmployee"/>
    <response name="error" type="view" value="EditEmployeeError"/>
</request-map>

<view-map name="EditEmployee" type="screen"
        page="component://hr/widget/management/EmployeeScreens.xml#EditEmployee"/>
```

```xml 3:4 subtitle="Because these responses only return data, they have no 'view-map' equivalents."
<request-map uri="saveEmployee">
    <security https="true" auth="true"/>
    <response name="success" type="request" value="json"/>
    <response name="error" type="request" value="json"/>
</request-map>
```

</Step>

</CodeSurferColumns>

---

<CodeSurfer>

```xml title="Controller Request Events" subtitle="Requests can execute some code before passing the data over to the response handler. This allows us to make any changes to the data, or the system."
        <event type="service" invoke="updateEmployee"/>
```

```xml 10,17 file=./snippets/controller-event.xml title="Controller Request Events" subtitle="Most common types of events are services. They can also be defined by an actual location in the code (i.e. the full java class name)."

```

</CodeSurfer>

---

## Screens

<!-- TODO -->

---

<CodeSurfer>

```xml 1:27 file=./snippets/screens.xml title="Screens"

```

```xml 6[19:30],32[52:83] file=./snippets/screens.xml title="Screens" subtitle="The screen name is what the controller 'view-map' references."

```

```xml 8:11 file=./snippets/screens.xml title="Screens" subtitle="Screens can also have their own logic. This should only fetch data that needs to be displayed on the screen."

```

```xml 13:14,22:23 file=./snippets/screens.xml title="Screens" subtitle="The decorator wraps the screen with all the global markup (application bar, scripts, style)."

```

```xml 16:20 file=./snippets/screens.xml title="Screens" subtitle="Freemarker template files can be injected into the screen directly. They get access to any context variables set up to this point."

```

</CodeSurfer>

---

## Services

Services are globally defined methods that can be invoked across the system.<br/>
Because they are global, check if there is a service with the same name before <br/>
creating one, otherwise one of them will end up overwriting the other one.

---

<CodeSurfer>

```xml 1:15 file=./snippets/services.xml title="Services"

```

```xml 7[20:33],20[35:48] file=./snippets/services.xml title="Services" subtitle="The service name is used by controller events."

```

```xml 8[9:73] file=./snippets/services.xml title="Services" subtitle="The location and invoke attributes define where the code for this service is."

```

```xml 7[36:48] file=./snippets/services.xml title="Services" subtitle="Services can be written in multiple languages (java, groovy, minilang). The engine attribute controls this."

```

```xml 10:13 file=./snippets/services.xml title="Services" subtitle="Because services act as methods, they can have input and output parameters."

```

```xml 10[49:60],11[51:59],12[50:58],13[56:65] file=./snippets/services.xml title="Services" subtitle="The mode attribute controls this. Service parameters can be 'IN' (input), 'OUT' (output) or 'INOUT' (both input and output)."

```

```xml 11[61:75],12[60:74] file=./snippets/services.xml title="Services" subtitle="Some parameters can also be optional. The service engine (which is responsible for executing these services) will use this definition to validate input and output parameters."

```

```xml 10[35:48],11[36:50],12[35:49],13[39:55] file=./snippets/services.xml title="Services" subtitle="The java variable type is also required for all parameters."

```

</CodeSurfer>

---

## Query classes

Query classes are a set of java classes we have introduced recently.<br/>
They allow us to keep all database queries in one place.

---

<CodeSurfer>

```clike file=./snippets/query-class.java title="Query classes"

```

```clike 1,3[36:50] file=./snippets/query-class.java title="Query classes" subtitle="All query classes are required to be in the 'com.stannah.queries' package, so that they can extend the 'AbstractQueries' abstract class."

```

```clike 10 file=./snippets/query-class.java title="Query classes" subtitle="A package-private constructor is also required."

```

```clike 5:8 file=./snippets/query-class.java title="Query classes" subtitle="Any entities and entity fields should be declared as constant strings."

```

```clike 12:18 file=./snippets/query-class.java title="Query classes" subtitle="Methods can contain any kind of queries, but they should not do any business logic. They can, at most, extract data from the results."

```

</CodeSurfer>

---

Fin.
